{include file="public/header"}
<!-- 配置文件 -->
<script type="text/javascript" src="utf8-php/ueditor.config.js"></script>
<!-- 编辑器源码文件 -->
<script type="text/javascript" src="utf8-php/ueditor.all.js"></script>
<!-- 实例化编辑器 -->
<script type="text/javascript">
    var ue = UE.getEditor('container');
</script>

<div class="content" id="lessonEdit">
	<div class="rightBox">
		<div class="main">
			
			<div class="seach_tigs" id="edit">
				<h3>修改课程</h3>
	            
	                <ul class="clearfix">
                        <li>
                            <label class="seach-label">
                                <span>*</span>课程名称：
                            </label>
                            <input type="text" name="" value="" class="form-control" v-model="name">
                        </li>
                        <li>
                            <label class="seach-label">
                                <span>*</span>课程编号：
                            </label>
                            <input type="text" name="" value="" class="form-control" v-model="code">
                        </li>
                        <li>
                        	<label class="seach-label">
                                <span>*</span>课程图片：
                            </label>
	                        <div class="file_top">
	                            <span>点击选择图片</span>
	                            <input type="file" name="img" id="file" class="upload" onchange="uploadpic(this)">
                                <input type="hidden" name="" class="" id="hpic" v-model="img">
                            </div>
                            <div class="fileBox">
                                <p>建议上传图片的尺寸比例为1:1，大小不超过1M</p>
                                <img :src="img" height="100" id="image">
                            </div>
                        </li>
                        <li>
                            <label class="seach-label">
                                <span>*</span>教师头像：
                            </label>
                            <div class="file_top">
                                <span>点击选择图片</span>
                                <input type="file" name="img" id="fileTea" class="upload" onchange="uploadTea(this)">
                                <input type="hidden" name="" class="" id="teac" v-model="pic">
                            </div>
                            <div class="fileBox">
                                <p>建议上传图片的尺寸比例为1:1，大小不超过1M</p>
                                <img :src="pic" height="100" id="imageTea">
                            </div>
                        </li>
                        <li>
                            <label class="seach-label">
                                <span>*</span>所属校区：
                            </label>
                            <select class="form-control input-median" text="true" name="" id="province_id" v-model="province">
                            </select>
                            <select class="form-control input-median" text="true" name="" id="city_id" v-model="city">
                            </select>
                            <select class="form-control input-median" text="true" name="" id="area" v-model="area" @change="choose()">
                            </select>
                            <select class="form-control input-median" name="" id="school_id" v-model='school_id'>
                                <option value="">请选择校区</option>
                                <option v-for='t in school_name' :value="t.ID">{{t.SCHOOL_NAME}}</option>
                            </select>
                        </li>
                        <li>
                        	<label class="seach-label">
                                <span>*</span>课堂类型：
                            </label>
                            <select class="form-control" name="type" v-model="lessonType2">
                                <option value="">请选择课堂</option>
                                <option :value="t.value" v-for="t in lessonType" name="selectId">{{t.label}}</option>
                            </select>
                        </li>
                        <li>
                            <label class="seach-label">
                                <span>*</span>班型：
                            </label>
                            <select class="form-control" name="type" v-model="classType">
                                <option value="">请选择班型</option>
                                <option :value="t.value" v-for="t in classType">{{t.label}}</option>
                            </select>
                        </li>
                        <li>
                            <label class="seach-label">
                                <span>*</span>学期：
                            </label>
                            <input type="text" name="" value="" class="form-control" v-model="semester">
                        </li>
                        <li>
                        	<label class="seach-label">
                                <span>*</span>选择年级科目：
                            </label>
                        	<select name="grade_id" class="form-control input-xlarge" id="grade_id" v-model="grade2">
		                        <option value="">请选择年级</option>
		                        <option :value="t.ID" v-for="t in grade">{{t.NAME}}</option>
		                        
	                        </select>
	                    	<select name="subject_id" id="subject_id" class="form-control input-xlarge" v-model="subjects2">
		                        <option value="">请选择科目</option>
		                        <option :value="t.ID" v-for="t in subjects">{{t.NAME}}</option>
		                        
	                        </select>
                        </li>
                        <li>
                        	<label class="seach-label">
                                <span>*</span>选择老师：
                            </label>
                            <select class="form-control" name="type" v-model="teacher2">
                                <option value="">请选择老师</option>
                                <option :value="t.ID" v-for="t in teacher">{{t.NAME}}</option>
                            </select>
                        </li>
                        
                        <li>
                        	<label class="seach-label">
                                <span>*</span>开课时间：
                            </label>
                        	<input class="form-control input-xlarge" id="test5" type="text"> 至
                        	<input class="form-control input-xlarge" id="test4" type="text">
                        </li>
                        <li>
                        	<label class="seach-label">
                                <span>*</span>课程节数：
                            </label>
                            <input type="number" name="" value="" class="form-control" v-model="lessonNum">
                        </li>
                        <li>
                        	<label class="seach-label">
                                <span>*</span>课程时长：
                            </label>
                            <input type="number" name="" value="" class="form-control" v-model="lessonTime">
                        </li>
                        <li>
                        	<label class="seach-label">
                                <span>*</span>课程详情：
                            </label>

                            <style>
                            	#edui1{width:100%;}
                            </style>
                            <!-- 加载编辑器的容器 -->
                            <textarea id="container" style="width:900px;margin-left:137px;margin-top:-23px;"  v-model="intro">
                                
                            </textarea> 
	
                        </li>
                        <li>
                        	<label class="seach-label">
                                排序：
                            </label>
                            <input type="number" name="" value="" class="form-control" v-model="num">
                        </li>
                        
                        <li class="seach"><input type="submit" name="" value="确认" @click="get()"><a href="javascript:history.back(-1)" id="back">返回</a></li>
                    </ul>
                
            </div>

		</div>
	</div>
</div>

{include file="public/footer"}
<script src="__PUBLIC__/admin/js/laydate.js"></script>
<script type="text/javascript">

function uploadpic(this0){
    
        $.ajaxFileUpload({
            fileElementId: 'file',    //需要上传的文件域的ID，即<input type="file">的ID。
            url: baseurl+'?s=admin/Uploadpic/index', //后台方法的路径
            type: 'post',   //当要提交自定义参数时，这个参数要设置成post
            dataType: 'json', //返回值类型 一般设置为json
            contentType: "application/x-www-form-urlencoded; charset=utf-8",
            success: function(data) {   //提交成功后自动执行的处理函数，参数data就是服务器返回的数据。
                console.log(data.src);
                $('#hpic').val(data.src);
                $('#image').attr('src',data.src);
            }
        });
    
}
function uploadTea(this0){
    
        $.ajaxFileUpload({
            fileElementId: 'fileTea',    //需要上传的文件域的ID，即<input type="file">的ID。
            url: baseurl+'?s=admin/Uploadpic/index', //后台方法的路径
            type: 'post',   //当要提交自定义参数时，这个参数要设置成post
            dataType: 'json', //返回值类型 一般设置为json
            contentType: "application/x-www-form-urlencoded; charset=utf-8",
            success: function(data) {   //提交成功后自动执行的处理函数，参数data就是服务器返回的数据。
                console.log(data.src);
                $('#teac').val(data.src);
                $('#imageTea').attr('src',data.src);
            }
        });
    
}

laydate.render({
  elem: '#test5',
  type: 'datetime'
});
laydate.render({
  elem: '#test4',
  type: 'datetime'
});


var vue=new Vue({
    el:'#lessonEdit',
    data:{
        name:'',//课程名称
        code:'',//编号
        price:'',
        img:'',//图片
        pic:'',
        province:'',//省
        city:'',//市
        area:'',//区
        school_id:[],//校区名
        lessonTypeid:'',
        lessonType:[
            {value:'金石V课',label:'金石V课'},
            {value:'金石拼课',label:'金石拼课'},
            {value:'金石1对1',label:'金石1对1'}
        ],//课堂类型
        classType:'',//班型
        semester:'',//学期
        gradeid:'',
        grade:[
            
        ],//年级
        subjectsid:'',
        subjects:[
            
        ],//科目
        teacherid:'',
        teacher:[
            
        ],//老师
        
        lessonNum:'',//课程节数
        lessonTime:'',//课程时长
        intro:'',//课程详情
        num:'',//序号
        id:'<?php echo @$_GET['id']?>'
    },
    methods:{
        get:function(){
            var startTime=$('#test5').val();
            var endTime=$('#test4').val();
            var intro=ue.getContent();
            var img=$('#hpic').val();
            console.log(intro);
            this.$http.post(baseurl+'?s=admin/Lesson/lesson_edit',{
                'name':this.name,//
                'code':this.code,//
                'price':this.price,//
                'img':img,//
                'province':this.province,//
                'city':this.city,//
                'area':this.area,//
                'school_id':this.school_id,
                'classType':this.classType,//
                'semester':this.semester,//
                'lessonNum':this.lessonNum,//
                'lessonTime':this.lessonTime,//
                'intro':intro,//
                'num':this.num,//
                'lessonTypeid':this.lessonTypeid,
                'gradeid':this.gradeid,
                'subjectsid':this.subjectsid,
                'teacherid':this.teacherid,//
                'startTime':startTime,//
                'endTime':endTime//
            }).then(res=>{
                if(res.bodyText==1){
                    layer.msg('保存成功！',function(){
                        window.history.go(-1);
                    })
                }
            },res=>{
                console.log('请求失败处理,请检查Network!');
            })
        },
        choose:function(){
            this.$http.post(baseurl+'?s=admin/Lesson/get_schoolval',{
                'city':this.city,
                'area':this.area}).then(res=>{
                    //console.log(res);
                    this.school_name=eval('('+res.bodyText+')');
                },res=>{
                    console.log('请求失败处理,请检查Network!');
                })
            
        },
        
    },
    created:function(){
        if(!this.id){
            return;
        }
        this.$http.post(baseurl+'?s=admin/Lesson/getcurriculum',{'id':this.id}).then(res=>{
            var val=eval('('+res.bodyText+')')[0];
            this.name=val['NAME'];
            this.code=val['CODE'];
            this.img=val['IMG'];
            this.province=val['PROVINCE'];
            this.city=val['CITY'];
            this.area=val['AREA'];
            this.school_name=val['SCHOOLID'];
            this.lessonType2=val['CLASSTYPEGUID'];
            this.classType=val['SEASONTYPE'];
            this.semester=val['SEMESTER'];
            this.grade2=val['CLASSGUID'];
            this.subjects2=val['SUBJECTGUID'];
            this.teacher2=val['TEACHERGUID'];
            this.lessonNum=val['COURSETNUM'];
            this.lessonTime=val['COURSETIME'];
            this.intro=val['CONTENT'];
            this.num=val['ORDERINDEX'];
            this.pic=val['PIC']
        },res=>{
             console.log('请求失败处理,请检查Network!');
        });
        //教师
        this.$http.post(baseurl+'?s=admin/Lesson/get_teacherval').then(res=>{
            var teaName=eval('('+res.bodyText+')');
            this.teacher=teaName['value'];
        },res=>{
            console.log('请求失败处理,请检查Network!');
        });
        //年级
        this.$http.post(baseurl+'?s=admin/Lesson/school_classList').then(res=>{
            var grade=eval('('+res.bodyText+')');
            this.grade=grade['value'];
        },res=>{
            console.log('请求失败处理,请检查Network!');
        });
        //科目
        this.$http.post(baseurl+'?s=admin/Lesson/subject_list').then(res=>{
            var subject=eval('('+res.bodyText+')');
            this.subjects=subject['value'];
        },res=>{
            console.log('请求失败处理,请检查Network!');
        })
    }
})


</script>
</body>
</html>